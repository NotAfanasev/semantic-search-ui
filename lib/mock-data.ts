import type { SearchResult, Document } from "./types"

export const mockDocuments: Document[] = [
  {
    id: "1",
    title: "Как оформить отпуск",
    content: `Для оформления отпуска необходимо выполнить следующие шаги:

1. Откройте корпоративный портал и перейдите в раздел "Мои заявки".
2. Нажмите "Создать заявку" и выберите тип "Ежегодный отпуск".
3. Укажите желаемые даты начала и окончания отпуска.
4. Приложите заполненное заявление (шаблон доступен в разделе "Документы").
5. Отправьте заявку на согласование руководителю.

Важно: заявку необходимо подать не менее чем за 14 календарных дней до начала отпуска. Руководитель рассмотрит заявку в течение 3 рабочих дней.

Если вам необходимо перенести уже согласованный отпуск, создайте новую заявку с типом "Перенос отпуска" и укажите причину переноса.`,
    createdAt: "2025-01-15",
    updatedAt: "2025-11-20",
  },
  {
    id: "2",
    title: "Политика удаленной работы",
    content: `Компания поддерживает гибридный формат работы. Вот основные правила:

Удаленная работа доступна для всех сотрудников, прошедших испытательный срок. Для оформления удаленного дня необходимо уведомить руководителя не менее чем за 24 часа.

Максимальное количество удаленных дней — 3 в неделю (для большинства позиций). Некоторые роли требуют постоянного присутствия в офисе.

Во время удаленной работы сотрудник обязан быть доступен в корпоративном мессенджере в рабочие часы (с 10:00 до 18:00). Все видеозвонки должны проводиться с включенной камерой.

Оборудование для удаленной работы можно запросить через IT-отдел.`,
    createdAt: "2025-03-01",
    updatedAt: "2025-10-15",
  },
  {
    id: "3",
    title: "Процедура онбординга новых сотрудников",
    content: `Онбординг нового сотрудника занимает 2 недели и включает следующие этапы:

День 1: Знакомство с командой, получение оборудования и доступов.
Дни 2-3: Прохождение обязательных курсов по информационной безопасности и корпоративной культуре.
Дни 4-7: Погружение в рабочие процессы под руководством наставника.
Дни 8-14: Первые самостоятельные задачи с регулярными check-in встречами.

Наставник назначается из числа опытных сотрудников команды. Он помогает новичку адаптироваться и отвечает на возникающие вопросы.

По завершении онбординга проводится встреча с HR для обратной связи.`,
    createdAt: "2025-02-10",
    updatedAt: "2025-09-30",
  },
  {
    id: "4",
    title: "Как подать заявку на обучение",
    content: `Компания компенсирует расходы на профессиональное обучение. Для подачи заявки:

1. Выберите курс или программу обучения.
2. Согласуйте с руководителем актуальность обучения для вашей роли.
3. Заполните форму "Заявка на обучение" на корпоративном портале.
4. Приложите описание программы и стоимость.
5. Дождитесь одобрения от HR и финансового отдела.

Лимит компенсации: до 150 000 рублей в год на одного сотрудника. Обучение должно быть связано с текущими или планируемыми рабочими задачами.

После прохождения обучения необходимо предоставить сертификат и краткий отчет о полученных знаниях.`,
    createdAt: "2025-04-20",
    updatedAt: "2025-12-01",
  },
  {
    id: "5",
    title: "Корпоративные бенефиты и льготы",
    content: `Наша компания предоставляет следующие бенефиты:

Медицинская страховка: ДМС для сотрудника и членов семьи (после 6 месяцев работы).
Фитнес: компенсация абонемента в фитнес-клуб до 5 000 рублей в месяц.
Питание: субсидированные обеды в офисе. 
Образование: компенсация обучения до 150 000 рублей в год.
Транспорт: компенсация проезда или корпоративная парковка.

Дополнительно: 
- Дни здоровья (2 дня в год без справки)
- Подарки к праздникам
- Корпоративные мероприятия
- Скидки у партнеров компании

Для активации бенефитов обратитесь в HR-отдел.`,
    createdAt: "2025-01-01",
    updatedAt: "2025-11-01",
  },
]

const searchResultsMap: Record<string, SearchResult[]> = {
  отпуск: [
    { id: "1", title: "Как оформить отпуск", snippet: "Для оформления отпуска необходимо выполнить следующие шаги: откройте корпоративный портал и перейдите в раздел \"Мои заявки\"...", score: 0.95 },
    { id: "5", title: "Корпоративные бенефиты и льготы", snippet: "Дни здоровья (2 дня в год без справки). Подарки к праздникам. Корпоративные мероприятия...", score: 0.42 },
  ],
  обучение: [
    { id: "4", title: "Как подать заявку на обучение", snippet: "Компания компенсирует расходы на профессиональное обучение. Для подачи заявки выберите курс или программу обучения...", score: 0.93 },
    { id: "3", title: "Процедура онбординга новых сотрудников", snippet: "Онбординг нового сотрудника занимает 2 недели и включает прохождение обязательных курсов...", score: 0.61 },
    { id: "5", title: "Корпоративные бенефиты и льготы", snippet: "Образование: компенсация обучения до 150 000 рублей в год...", score: 0.55 },
  ],
  удаленная: [
    { id: "2", title: "Политика удаленной работы", snippet: "Компания поддерживает гибридный формат работы. Удаленная работа доступна для всех сотрудников, прошедших испытательный срок...", score: 0.97 },
  ],
  онбординг: [
    { id: "3", title: "Процедура онбординга новых сотрудников", snippet: "Онбординг нового сотрудника занимает 2 недели и включает: знакомство с командой, получение оборудования и доступов...", score: 0.96 },
    { id: "4", title: "Как подать заявку на обучение", snippet: "Компания компенсирует расходы на профессиональное обучение...", score: 0.38 },
  ],
  бенефиты: [
    { id: "5", title: "Корпоративные бенефиты и льготы", snippet: "Наша компания предоставляет следующие бенефиты: ДМС, фитнес, питание, образование, транспорт...", score: 0.98 },
    { id: "4", title: "Как подать заявку на обучение", snippet: "Компания компенсирует расходы на профессиональное обучение до 150 000 рублей в год...", score: 0.65 },
    { id: "1", title: "Как оформить отпуск", snippet: "Заявку необходимо подать не менее чем за 14 календарных дней...", score: 0.41 },
  ],
}

export function findMockResults(query: string): SearchResult[] {
  const lowerQuery = query.toLowerCase()

  for (const [key, results] of Object.entries(searchResultsMap)) {
    if (lowerQuery.includes(key)) {
      return results
    }
  }

  // Default: return all documents with varying scores for any query
  return mockDocuments.map((doc, index) => ({
    id: doc.id,
    title: doc.title,
    snippet: doc.content.slice(0, 140) + "...",
    score: Math.max(0.3, 0.85 - index * 0.12),
  }))
}

export function findMockDocument(id: string): Document | undefined {
  return mockDocuments.find((doc) => doc.id === id)
}

export function getAllDocuments(): Document[] {
  return [...mockDocuments]
}

let nextId = mockDocuments.length + 1

export function addDocument(data: { title: string; content: string }): Document {
  const now = new Date().toISOString().split("T")[0]
  const doc: Document = {
    id: String(nextId++),
    title: data.title,
    content: data.content,
    createdAt: now,
    updatedAt: now,
  }
  mockDocuments.push(doc)
  return doc
}

export function updateDocument(
  id: string,
  data: { title: string; content: string }
): Document | undefined {
  const index = mockDocuments.findIndex((doc) => doc.id === id)
  if (index === -1) return undefined
  const now = new Date().toISOString().split("T")[0]
  mockDocuments[index] = {
    ...mockDocuments[index],
    title: data.title,
    content: data.content,
    updatedAt: now,
  }
  return mockDocuments[index]
}

export function deleteDocument(id: string): boolean {
  const index = mockDocuments.findIndex((doc) => doc.id === id)
  if (index === -1) return false
  mockDocuments.splice(index, 1)
  return true
}
